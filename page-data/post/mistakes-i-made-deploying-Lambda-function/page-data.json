{"componentChunkName":"component---src-templates-blog-post-js","path":"/post/mistakes-i-made-deploying-Lambda-function/","result":{"data":{"site":{"siteMetadata":{"title":"Rajitha's blog"}},"markdownRemark":{"id":"9a07a1d1-df4e-5db8-9179-20caab1aba8f","excerpt":"hi everyone, Hope you all are safe and sound.\n So in this post, I'll walk through some of the mistakes I made developing an AWS lambda video transcoder and howâ€¦","html":"<h2>hi everyone,</h2>\n<span style=\"font-size:1.18em;text-align: justify;\" >\n<p>Hope you all are safe and sound.\n<br></p>\n<p>So in this post, I'll walk through some of the mistakes I made developing an AWS lambda video transcoder and how I got through them.\nthe lambda function I developed will trigger on an s3 create object event and it will transcode a video using <a href=\"https://www.ffmpeg.org/\">FFmpeg</a> library and it will upload the transcoded video to another s3 bucket.i used serveless framework to ease the process and it really did . i combined it with github action to deploy to AWS.\nat this point you might ask why don't you use aws <a href=\"https://aws.amazon.com/elastictranscoder/\">Elastic Transcoder</a> or AWS <a href=\"https://aws.amazon.com/mediaconvert/\"> Elemental MediaConvert</a> . for start they are pricy and in the other hand i can get more knowledge and expericane by doing it myself in lamda so i chose the hard way .</p>\n</span>\n<h2>1 <sup>st</sup> mistake</h2>\n<span style=\"font-size:1.18em;text-align: justify;\" >\n<p>s3 bucket and triggering lambda function both should be in the same region. this is well specified in most resources but I missed it.</p>\n</span>\n<br>\n<h2>2 <sup>nd</sup> mistake</h2>\n<br>\n<span style=\"font-size:1.18em;text-align: justify;\" >\n<p>I created and separate IAM roles to upload and get objects from the s3 buckets, and used that with AWS-SDK. this was the normal procedure, I've done it more than once so why bother, but turns out that was not essential, it will work but unnecessary because in AWS lambda you can specify the lambda Execution role\nso that I can access other AWS resources without any credentials.</p>\n</span>\n<br>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/645f4291ecdc0057ceec51f0fc9b544a/07e9f/lamdapolicy_hxp3xt.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 45.65217391304348%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAwUlEQVR42n2RUQ6CMBBEe//L+eMJ0ERAVKB0290t6NAaU0xgaAhsOn0zYM7VqXt2FJhVWaRcGmOc570lqmYYV02vu5us98EnhRDIe1jf+1qWxahGFvY0iQre50KxUE5RDvFsPK0oZOCkuFU+BYc6cl33wOYSYESEiNyEyyHvXkgUud1qFCyHiK0hMODAHjQEoLpc+37Ibb/mTF7hDjd/SG6stRsyijFL+sABf+fAXNfN+GeGM2FX7rKjbG7aNpN/8w8/uxDXrVQmGAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"permissions in lamda function menu\" title=\"\" src=\"/static/645f4291ecdc0057ceec51f0fc9b544a/c0255/lamdapolicy_hxp3xt.png\" srcset=\"/static/645f4291ecdc0057ceec51f0fc9b544a/81c8e/lamdapolicy_hxp3xt.png 230w,\n/static/645f4291ecdc0057ceec51f0fc9b544a/08a84/lamdapolicy_hxp3xt.png 460w,\n/static/645f4291ecdc0057ceec51f0fc9b544a/c0255/lamdapolicy_hxp3xt.png 920w,\n/static/645f4291ecdc0057ceec51f0fc9b544a/07e9f/lamdapolicy_hxp3xt.png 1301w\" sizes=\"(max-width: 920px) 100vw, 920px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<br>\n<h2>3 <sup>rd</sup> mistake</h2>\n<span style=\"font-size:1.18em;text-align: justify;\" >\n<p>only giving get s3 object permission will give <code class=\"language-text\">403</code> <code class=\"language-text\">access denied</code> error if the specified key is not available in the bucket.</p>\n</span>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 795px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/cfb26e22c84982b3181132dfc6a3c77b/65c7b/accessdenied_gwnkpm.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 38.260869565217384%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAA7EAAAOxAGVKw4bAAABGUlEQVR42k1QB5KEMAzj/09jIYWa0G/pISyw8IATAW5O48m4SLZjKxYiDCMhEyHEMI5ZliOMYxFFMcwPzqgoyizPkyQVUr7rd2eg1GRxz7NtBzzQGPcoZY5LYIRxhIRQxrhtv5ITadf1Sqlt247j2PfdgowZHmU8CELfD7jx0cXzfOQxuiiKNMv6fpimSWv9fWCBbbp7jkNkkgZhxDgnlF5iGOe+lAmcqvqBchzHZVkecQCEKJdVhQK2QnM13QAbmTOrJtjns2g9r+t6i12XYk+XUPzz5bg4GI5R103btn3fX7dpmhYvMlc4DAO+fYqd8zhUCImpqCqDe4UHl29eDWee53tyWZZN09R13Zre27oeN/Y//PcvXOJfr76mGGdTLtkAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"cloudwatch log 403\" title=\"\" src=\"/static/cfb26e22c84982b3181132dfc6a3c77b/65c7b/accessdenied_gwnkpm.png\" srcset=\"/static/cfb26e22c84982b3181132dfc6a3c77b/81c8e/accessdenied_gwnkpm.png 230w,\n/static/cfb26e22c84982b3181132dfc6a3c77b/08a84/accessdenied_gwnkpm.png 460w,\n/static/cfb26e22c84982b3181132dfc6a3c77b/65c7b/accessdenied_gwnkpm.png 795w\" sizes=\"(max-width: 795px) 100vw, 795px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<br>\n<span style=\"font-size:1.18em;text-align: justify;\" >\n<p>and because of this, I wasted time configuring IAM roles because I was confused that the lambda function didn't have permission to access the bucket but, in the end, it was my stupid mistake because the key I passed didn't exist, and guess what I didn't gave permission to list bucket , so AWS-SDK will return access denied error instead of no key found . after configuring correct permission I got no key found error. but why you would specify a key that doesn't exist huh, well next one explains that</p>\n</span>\n<br>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 913px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/62ab80508e61da79ddabf33b7c4d1f19/0eb6d/nokey_cdm9ax.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 33.47826086956522%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAA40lEQVR42oVQ2XKEIBD0/z/Qk1M36mJAERWP0mwveYmpVKULpmage66IUiaElLLsus+nUggpe79wIQmh1ePRNK0sSzj9MFg7TtM84c6z92uUplma5YEtoMyLIsthCJQFoXDxpZRyzm3bdl3X1w9EhNK8IHGcgs8YBztJsyRBSJGirpuPujbGbNv+hxgMyngdGMb0bftEn0CYosNRquv7Acp5Wc7z/C3mXJRVhcEh+K4A+HWFXQO890vAcRw3cRyjx0xrba1FBViMN44Ou4F1bnIBWFIYe7+JsWGtTeC5fb8l/hcv6kWIO5O4LzQAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"cloudwatch log 404\" title=\"\" src=\"/static/62ab80508e61da79ddabf33b7c4d1f19/0eb6d/nokey_cdm9ax.png\" srcset=\"/static/62ab80508e61da79ddabf33b7c4d1f19/81c8e/nokey_cdm9ax.png 230w,\n/static/62ab80508e61da79ddabf33b7c4d1f19/08a84/nokey_cdm9ax.png 460w,\n/static/62ab80508e61da79ddabf33b7c4d1f19/0eb6d/nokey_cdm9ax.png 913w\" sizes=\"(max-width: 913px) 100vw, 913px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<br>\n<h2>4 <sup>th</sup> mistake</h2>\n<span style=\"font-size:1.18em;text-align: justify;\" >\n<p>The next one is missing the decodeURIComponent on the s3 triggered event object key.because s3 object keys are URL encoded, I thought I pass\n<code class=\"language-text\">Capone - OhNo(Lyrics).mp4</code> but actually what I passed was <code class=\"language-text\">Capone+-+OhNo%28Lyrics%29.mp4</code>. so I had to decode the key using <code class=\"language-text\">decodeURIComponent</code> and pass it .</p>\n</span>\n<p><br><br>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 920px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/35837d98db1ba2ba4586a733ed60852c/bb051/carbon_cmljtv.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 39.565217391304344%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABa0lEQVR42pWPyU7CUBSG+y5qaAXKVAplCMrO+CJEF6CQiGA3RIa4AoJuIKAICi0OEGVwiIK+1++5gAZdGF189/Se3P87PZw+nEAbTNAZvUMfvUEf/p/OA2XJw+C0wRi1Th+5UhWZfAXZQnlGcU7hd3L05ui4ipren/4Yp/XHULNFbMgyApsylq0yBJMT/BxBlMGbnd9gvdUFWE/N5GfCZu8JMTUDs9EBp+yFTXJBkhX6ViC7PTBa6G51w2WjHlWGnRBIYqAMb5KwItimjoveM7jzmxF2Eiks8TYK+eElqd0XhIPw+gMQnT5IniAk9zqxBklZh10JwkLvRBpusrpI6kBkP4XG7SMJ6YipaRhokplNpsqb52uylVldXFuc3QWqnysbSMgczS4JG3QUyk1Ek4fY2k0gFIkjFN6j+oPwAl/9OLajSUQP0siTg7m41v0r6ldDlC+7ODnTUKq1/85pmzI6KpStXw/RunvBB/q7czLUBTPCAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"decodeURIComponent\" title=\"\" src=\"/static/35837d98db1ba2ba4586a733ed60852c/c0255/carbon_cmljtv.png\" srcset=\"/static/35837d98db1ba2ba4586a733ed60852c/81c8e/carbon_cmljtv.png 230w,\n/static/35837d98db1ba2ba4586a733ed60852c/08a84/carbon_cmljtv.png 460w,\n/static/35837d98db1ba2ba4586a733ed60852c/c0255/carbon_cmljtv.png 920w,\n/static/35837d98db1ba2ba4586a733ed60852c/bb051/carbon_cmljtv.png 1212w\" sizes=\"(max-width: 920px) 100vw, 920px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n<br><br></p>\n<span style=\"font-size:1.18em;text-align: justify;\" >\n<p>and like that everything was comming together.\nhere is <a href=\"https://github.com/RizkyRajitha/serverless-transcoder\">github repo</a></p>\n<p>Thanks for reading so far.<br>\nStay safe folks ðŸ™Œ\n</span></p>","frontmatter":{"title":"Mistakes i made deploying Lambda function","date":"May 04, 2021","description":null,"ogimage":"mistakes-i-made-deploying-Lambda-function.png"}},"previous":{"fields":{"slug":"/post/Realtime-Anemometer-Project/"},"frontmatter":{"title":"Realtime Anemometer Project"}},"next":{"fields":{"slug":"/post/setup-prometheus-and-grafana-on-orange-pi/"},"frontmatter":{"title":"Setup Prometheus and Grafana on Orange Pi"}}},"pageContext":{"id":"9a07a1d1-df4e-5db8-9179-20caab1aba8f","previousPostId":"c622932e-56c6-5a04-b1a7-c2a0c9f470a2","nextPostId":"1e1ede0c-1fb4-573b-805f-6664b223c8a8"}},"staticQueryHashes":["2841359383"],"slicesMap":{}}